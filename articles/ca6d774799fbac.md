---
title: "ã€å‚™å¿˜éŒ²ã€‘Next.js(App Router)ã§ã®ã‚¹ãƒ‹ãƒšãƒƒãƒˆé›†"
emoji: "ğŸŒ¸"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["nextjs", "nextauth", "mantine"]
published: false
---

# ã¯ã˜ã‚ã«

æœ€è¿‘Next.js + Auth.js(NextAuth.js) + Mantineã‚’ã‚ˆãè§¦ã£ã¦ã„ã¾ã™ã€‚ãã®éš›ã€Œã‚ã‚Œï¼Ÿã‚ã®ã‚³ãƒ¼ãƒ‰ã©ã†ã‚„ã£ã¦æ›¸ã„ãŸã£ã‘ãƒ»ãƒ»ãƒ»ï¼Ÿã€ã¿ãŸã„ãªã“ã¨ãŒã‚ˆãèµ·ãã¾ã™ã€‚ã€Œã‚ã®ã‚µã‚¤ãƒˆã«æ›¸ã„ã¦ã‚ã£ãŸã¯ãš / ã‚ãã“ã«æ›¸ã„ãŸã¯ãšã€ã¿ãŸã„ãªå‚ç…§ã‚’ç¹°ã‚Šè¿”ã—ã¦ã„ã¦ä¸ä¾¿ã‚’æ„Ÿã˜ã¦ã„ã¾ã—ãŸã€‚

æœ¬è¨˜äº‹ã¯ä¸Šè¨˜ã®ä¸ä¾¿ã‚’è§£æ¶ˆã™ã‚‹ãŸã‚ã®å‚™å¿˜éŒ²çš„ãªè¨˜äº‹ã§ã™ã€‚éšæ™‚æ›´æ–°äºˆå®šãªã®ã¨é›‘ã«ã¾ã¨ã‚ã‚‹è¨˜äº‹ã®ãŸã‚ã€åˆ†é‡ã¯å¤šå²ã«æ¸¡ã£ã¦ã—ã¾ã†ã‹ã¨æ€ã„ã¾ã™ã€‚

## å‰æ

è¨˜äº‹ä½œæˆæ™‚ã®ç’°å¢ƒã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚

- Next.js: 14.0.0 (App Router)
- Mantine: 7.2.2

[//]: # (- NextAuth.js: 4.24.5)

# Next.js App Routeré–¢é€£

## ã‚µãƒ¼ãƒãƒ¼ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®`Page.tsx`ã§ãƒ‘ã‚¹ãƒ»ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ»ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’å–å¾—ã™ã‚‹

ã‚µãƒ¼ãƒãƒ¼ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ãƒ‘ã‚¹ã‚„ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹ã«ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«Pageã®å¼•æ•°ã«`params`ã¨`searchParams`ã‚’æŒ‡å®šã—ã¾ã™ã€‚

```typescript jsx : app/test/[id]/page.tsx
import { headers } from 'next/headers'

export default function Page({
  params,
  searchParams,
}: {
  params: { id: string };
  searchParams: { [key: string]: string | string[] | undefined };
}) {
  const a = searchParams.a;
  const b = searchParams.b;
  const headersInstance = headers()

  return (
    <>
      <h1>Page</h1>
      <p>a: {a}</p>
      <p>b: {b}</p>
      <p>params: {params.id}</p>
      <p>{JSON.stringify(headersInstance)}</p>
    </>
  );
}
```

![](/images/nextjs_snippets/nextjs_snippets_01.png =600x)
*`http://localhost:3000/test/1?a=1&b=2`ã§ã‚¢ã‚¯ã‚»ã‚¹ã—ãŸæ§˜å­*

ãƒ‘ã‚¹ã¨ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¨ãƒ˜ãƒƒãƒ€ãƒ¼ãŒå–ã‚Œã¦ã„ã‚‹ã“ã¨ãŒç¢ºèªã§ãã¾ã™ã€‚

https://nextjs.org/docs/app/api-reference/file-conventions/page
https://nextjs.org/docs/app/api-reference/functions/headers
https://zenn.dev/igz0/articles/e5f6f08b6cbe1d


ã¡ãªã¿ã«ã€`layout.tsx`ã§ã¯`params`ã¨`children`ã®ã¿å¼•æ•°ã«ã¨ã‚‹ã“ã¨ãŒã§ãã¦ã€`searchParams`ã‚’å¼•æ•°ã«å–ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚ãŸã ã€å½“ç„¶ã¨è¨€ãˆã°å½“ç„¶ã§ã™ãŒ`app/`ç›´ä¸‹ã®RootLayoutã¯`children`ã®ã¿ã§ã™ã€‚

```typescript jsx : app/test/[id]/layout.tsx
export default function DashboardLayout({
  children,
  params,
}: {
  children: React.ReactNode,
  params: { id: string };
}) {
  return <section>
    <p>layout.id: {params.id}</p>
    {children}
  </section>
}
```

![](/images/nextjs_snippets/nextjs_snippets_02.png =600x)
*`http://localhost:3000/test/typescript?a=1&b=2`ã§ã‚¢ã‚¯ã‚»ã‚¹ã—ãŸæ§˜å­*

https://nextjs.org/docs/app/api-reference/file-conventions/layout

ä¸Šè¨˜ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«æ¤œç´¢æ™‚ã®å‹•çš„ã‚¯ã‚¨ãƒªãªã©ã«åˆ©ç”¨ã§ãã¾ã™ã€‚

https://www.ai-shift.co.jp/techblog/3766
https://zenn.dev/rgbkids/articles/039333a5e74712

## Server Actionsã‚’åˆ©ç”¨ã™ã‚‹

åŸºæœ¬çš„ã«ã¯ä»¥ä¸‹ã®ãƒšãƒ¼ã‚¸ã‚’è¦‹ã‚Œã°è‰²ã€…æ›¸ã„ã¦ã‚ã‚‹ã®ã§ã™ãŒã€TypeScriptã§è¨˜è¿°ã™ã‚‹ã¨ãã®å‹æƒ…å ±ãŒãªãã¦ã„ã¤ã‚‚å›°ã£ã¦ã—ã¾ã£ã¦ã„ã¾ã™ã€‚

https://nextjs.org/docs/app/api-reference/functions/server-actions

ã¾ãšã¯ã€ã‚µãƒ¼ãƒãƒ¼ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’å®Ÿè£…ã—ã¦ã¿ã¾ã™ã€‚ã“ã®æ™‚ã€`ServerRequest.name`ã¯formã‹ã‚‰å—ã‘å–ã‚‹å€¤ã‚’ã€`ServerResponse.message`ã¯ã“ã®Actionã®è¿”ã‚Šå€¤ã‚’æƒ³å®šã—ã¦ã„ã¾ã™ã€‚

```typescript: actions.ts
"use server";

interface ServerRequest {
  name: string;
}

interface ServerResponse {
  message: string;
}

export const actionPost = async (
  _: ServerResponse,
  req: ServerRequest,
): Promise<ServerResponse> => {
  const headers = {
    "Content-Type": "application/json",
  };
  return fetch("https://localhost:8080/api/v1/user", {
    method: "POST",
    body: JSON.stringify({ name: "john" }),
    headers,
  })
    .then((res) => {
      return { message: "success" };
    })
    .catch((err) => {
      return { message: "fail" };
    });
};
```

ã“ã“ã«Clientã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’æ›¸ã

```typescript jsx :
"use client";
import React, { useState } from "react";
import { useFormState } from "react-dom";
import {
  Alert,
  ActionIcon,
  Dialog,
  Loader,
  Tooltip,
  Modal,
} from "@mantine/core";
import {
  IconExternalLink,
  IconHeartPlus,
  IconTimeline,
  IconHeartMinus,
} from "@tabler/icons-react";
import { useDisclosure, useMediaQuery } from "@mantine/hooks";
import { ComposedChart } from "@/model/Chart";
import { actionUnTracking } from "./_actionsUnTracking";

export const actionButton = ({
  code,
  name,
}: {
  code: string | null;
  name: string | null;
}) => {
  const [dialogOpened, { open: dialogOpen, close: dialogClose }] =
    useDisclosure(false);
  const [unTrackingNow, setUnTrackingNow] = useState(false);
  const [unTracked, setUnTracked] = useState(false);
  const [unTrackingState, unTracingForm] = useFormState(actionUnTracking, {
    message: "initial",
  });
  const onUnTrackingStock = async () => {
    dialogOpen();
    setUnTrackingNow(true);
    setUnTracked(true);
    unTracingForm({ code });
  };

  return (
    <form onSubmit={onUnTrackingStock}>
      <ActionIcon type={"submit"} variant={"subtle"}>
        <Tooltip label={unTracked ? "é™¤å¤–æ¸ˆã¿ã§ã™" : "è¿½è·¡éŠ˜æŸ„ã‹ã‚‰å¤–ã™"}>
          {unTrackingNow ? (
            <Loader size={"xs"} />
          ) : (
            <IconHeartMinus color={unTracked ? "gray" : "red"} />
          )}
        </Tooltip>
        <Dialog
          opened={dialogOpened && !unTracked}
          onClose={dialogClose}
          size="lg"
          radius="md"
        >
          <Alert
            icon={<IconHeartPlus size="1rem" />}
            title="é€šçŸ¥"
            color="orange"
            withCloseButton
          >
            ã€{code}ã€‘{name}ã‚’è¿½è·¡éŠ˜æŸ„ã‹ã‚‰å¤–ã—ã¾ã—ãŸã€‚
          </Alert>
        </Dialog>
      </ActionIcon>
    </form>
  );
};
```

https://www.zenryoku-kun.com/new-post/nextjs-server-actions#about-old-form
https://zenn.dev/cybozu_frontend/articles/server-actions-deep-dive
https://zenn.dev/cybozu_frontend/articles/server-actions-and-revalidate
https://reffect.co.jp/react/next-j-server-actions/


APIã‚’å‘¼ã³å‡ºã™å‡¦ç†ã‚’æ›¸ãã€‚

## fetch()ã‚’ä½¿ã£ã¦ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆ

`Promise<{ status: string; data: {}[] }>`ã®ã‚ˆã†ã«è¿”ã‚Šå€¤ã®å‹å®šç¾©ã‚’ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

```typescript
const apiRequest = (): Promise<{ status: string; data: {}[] }> =>
fetch("https://localhost:8080/api/v1/user", {
  headers,
}).then((x) => x.json());
const items = await apiRequest();
```

## App Routerã§ã®APIå®Ÿè£…ï¼ˆRoute Handlersï¼‰

`app/api`ä»¥ä¸‹ã«`route.ts`ã¨ã„ã†åå‰ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã™ã‚‹ã¨`GET`ã‚„`POST`ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‚ç…§å¯èƒ½ã«ãªã‚Šã¾ã™ã€‚ä»¥ä¸‹ã¯ã€å…¬å¼ã®ã‚µãƒ³ãƒ—ãƒ«ã‚’ä¸€éƒ¨æ”¹å¤‰ã—ãŸã‚‚ã®ã§ã™ã€‚

```typescript: app/api/v1/product
import { NextResponse } from "next/server";

export async function GET(request: Request) {
  const { searchParams } = new URL(request.url)
  const id = searchParams.get('id')
  const res = await fetch(`https://data.mongodb-api.com/product/${id}`, {
    headers: {
      'Content-Type': 'application/json',
    },
  })
  const product = await res.json()
 
  return NextResponse.json({ product })
}
```

ãƒ‘ã‚¹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãªã©ç´°ã‹ã„å®Ÿè£…ã¯ä»¥ä¸‹ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’è¦‹ãŸæ–¹ãŒæ—©ã„ã§ã™ã€‚

https://nextjs.org/docs/app/building-your-application/routing/route-handlers


[//]: # (# Next.js + Mantineé–¢é€£)
[//]: # (## useFormã®submitã§Server Actionsã‚’åˆ©ç”¨ã™ã‚‹)


# ãã®ã»ã‹

ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®é–‹ç™ºæ™‚ãŒåœ°å‘³ã«ä¾¿åˆ©ã«ãªã‚‹ã‚µã‚¤ãƒˆãªã©ã§ã™ã€‚

## GETã‚„POSTãªã©ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ã‚µãƒ³ãƒ—ãƒ«

https://jsonplaceholder.typicode.com/

ã‚µãƒ³ãƒ—ãƒ«ã®ãƒãƒã§ã™ãŒã€ä»¥ä¸‹ã®ã‚ˆã†ãªãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é£›ã°ã™ã¨

```javascript
fetch('https://jsonplaceholder.typicode.com/todos/1')
      .then(response => response.json())
      .then(json => console.log(json))
```

ä»¥ä¸‹ã®ã‚ˆã†ãªãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ã—ã¦ãã‚Œã¾ã™ã€‚

```json
{
  "userId": 1,
  "id": 1,
  "title": "delectus aut autem",
  "completed": false
}
```

APIã®ç–é€šç¢ºèªã¨ã‹ã«ä½¿ãˆãã†ã§ã™ã€‚POSTã‚„PUTãªã©ã‚‚å­˜åœ¨ã—ã¦ã„ã‚‹ã®ã§ä¸€é€šã‚Šã®ç¢ºèªã«ä½¿ãˆãã†ã§ã™ã€‚ï¼ˆRoute Handler / API Routesãªã©ã§ä»£ç”¨ã‚‚ã§ããã†ã§ã™ãŒãƒ»ãƒ»ãƒ»ã€‚ï¼‰

## ç”»åƒã®ãƒ—ãƒ¬ã‚¤ã‚¹ãƒ›ãƒ«ãƒ€

https://placehold.co/

æ¬¡ã®ã‚ˆã†ãªã€ç”»åƒã‚µã‚¤ã‚ºã¨ãƒ†ã‚­ã‚¹ãƒˆã‚’æŒ‡å®šã—ãŸURLã§

```text
https://placehold.co/400x250?text=Hello,World!
```

ä¸‹ã®ç”»åƒã‚’è¡¨ç¤ºã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

![](https://placehold.co/400x250?text=Hello,World!)

ãã®ã»ã‹ã«ã‚‚è‰²ã‚„ãƒ•ã‚©ãƒ³ãƒˆã®æŒ‡å®šãªã©ã‚‚å¯èƒ½ã§ã™ã€‚

```text
https://placehold.co/400x250/orange/white?text=Hello+World&font=roboto
```

![](https://placehold.co/400x250/orange/white?text=Hello,World!&font=roboto)


## ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã§åˆ©ç”¨ã§ãã‚‹ã‚¢ã‚¤ã‚³ãƒ³

ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã§åˆ©ç”¨ã™ã‚‹Iconã¯ä»¥ä¸‹ã®`tabler`ãŒãŠã™ã™ã‚ã§ã™ã€‚

https://tablericons.com/

ãƒ•ãƒªãƒ¼ç´ æã¨ã—ã¦æ¬¡ã®ã‚µã‚¤ãƒˆã‚‚ä¾¿åˆ©ã§ã™ã€‚

https://loosedrawing.com/

## PWAç”¨ã®ã‚¢ã‚¤ã‚³ãƒ³ã‚’ä½œæˆã™ã‚‹

PWAç”¨ã®ã‚¢ã‚¤ã‚³ãƒ³ã‚’ä½œæˆã™ã‚‹å ´åˆã«ã€ä»¥ä¸‹ã®ã‚µã‚¤ãƒˆã‚’åˆ©ç”¨ã™ã‚‹ã¨ã‚µã‚¤ã‚ºã‚„èƒŒæ™¯è‰²ãªã©ã‚’å¤‰ãˆã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

https://maskable.app/editor



