---
title: "cognitoã®å„ç¨®èªè¨¼ç”»é¢ã‚’ç‹¬è‡ªå®Ÿè£…ã™ã‚‹"
emoji: "ğŸ”±"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["cognito", "nextjs", "mui"]
published: false
---

# ã¯ã˜ã‚ã«

Cognitoã®èªè¨¼ã‚’åˆ©ç”¨ã™ã‚‹ã¨ãã«ã€HostedUIã¨ã‹ã¯ã„ã„ã‘ã©ã€ã‚„ã£ã±ã‚Šè‡ªåˆ†ã§ä½œã‚ŠãŸã„ã¨æ€ã†æ™‚ãŒã‚ã‚Šã¾ã™ã€‚
HostedUIã¯ã‚µãƒ¼ãƒ“ã‚¹ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã«åˆã‚ãªã‹ã£ãŸã‚Šã™ã‚‹ãŸã‚ã§ã™ã€‚
ã¾ãŸã€AmplifyUIã‚‚ã‚ã‚Šã¾ã™ãŒã€ã“ã‚Œã‚‚åˆ©ç”¨ã—ãªãã¦ã‚‚ç”»é¢ã¯å®Ÿè£…ã—ã¦ã„ãã¾ã™ã€‚

ãã“ã§ã€ä»Šå›ã¯UIãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã®1ã¤ã§ã‚ã‚‹MUIã‚’ä½¿ã£ã¦ã‚µã‚¤ãƒ³ã‚¤ãƒ³ç”»é¢ã‚„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´ç”»é¢ãªã©ã‚’å®Ÿè£…ã—ã¦ã„ãã¾ã™ã€‚
ç”»é¢ã¯`MUI`ã‚’ãƒ™ãƒ¼ã‚¹ã«ä½œã‚‰ã‚Œã¦ã„ã¾ã™ãŒã€èªè¨¼ã¾ã‚ã‚Šã®å‡¦ç†ã¯å˜ä¸€ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦åˆ‡ã‚Šå‡ºã•ã‚Œã¦ã„ã‚‹ãŸã‚ã€`React`ã‚„`Next.js`ã‚’åˆ©ç”¨ã™ã‚‹å ´åˆãªã‚‰ã€
ã»ã¼ã»ã¼ã‚³ãƒ”ãƒšã§åˆ©ç”¨ã§ãã‚‹ã‹ã¨æ€ã„ã¾ã™ã€‚

ä¸»ã«å‚è€ƒã«ã—ãŸã®ã¯ä»¥ä¸‹ã®è¨˜äº‹ã«ãªã£ã¦ã„ã¾ã™ã€‚

https://mseeeen.msen.jp/react-auth-with-ready-made-cognito/

ã“ã®è¨˜äº‹ã®ä¸­ã§ã‚‚è¿°ã¹ã‚‰ã‚Œã¦ã„ã¾ã™ãŒã€`aws-amplify`ã®ä¸­ã®`Auth`ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’åˆ©ç”¨ã—ã¦
èªè¨¼ã¾ã‚ã‚Šã®å‡¦ç†ã‚’çµ„ã‚“ã§ã„ãã¾ã™ã€‚
ã“ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¯`Amplify`ã¨ã¯ä½•ã‚‚é–¢ä¿‚ãŒãªãå˜ç´”ã«èªè¨¼ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¨ã—ã¦ä¾¿åˆ©ãªãŸã‚åˆ©ç”¨ã—ã¾ã™ã€‚



ãƒ­ã‚°ã‚¤ãƒ³ã®è¦‹ãŸç›®ã¯MUIã‚’ä½¿ã£ã¦ã„ã‚‹ã®ã§ã€ä»¥ä¸‹ã®ãƒšãƒ¼ã‚¸ã®ã‚’å‚è€ƒã«ã—ãŸã€‚

https://qiita.com/shunnami/items/98a341d2ac20775241ad

# åˆ©ç”¨æ™‚ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ãƒ»ã“ã®è¨˜äº‹ã®å¯¾è±¡èª­è€…

åˆ©ç”¨æ™‚ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã¯æ¬¡ã®ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚
æœ€åˆã®ç”»é¢ã¯ã‚µãƒ¼ãƒ“ã‚¹ã®ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ã‚’æƒ³å®šã—ã¦ã„ã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/c0110fa4ebec-20230225.png =600x)
*ã‚µã‚¤ãƒ³ã‚¤ãƒ³å‰ã®çŠ¶æ…‹*

ç”»é¢å³ä¸Šã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãƒœã‚¿ãƒ³ã‚’æŠ¼ä¸‹ã™ã‚‹ã¨ã€ã‚µã‚¤ãƒ³ã‚¤ãƒ³ç”»é¢ã«é·ç§»ã—ã¾ã™ã€‚
ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æƒ…å ±ã‚’å…¥åŠ›ã—ã¦èªè¨¼ãŒæˆåŠŸã™ã‚‹ã¨ã€ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ã«é·ç§»ã—ã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/2fd3e250ffbb-20230225.png =600x)
*ã‚µã‚¤ãƒ³ã‚¤ãƒ³ç”»é¢*

èªè¨¼æ¸ˆã¿ã®å ´åˆã¯ã€èªè¨¼å¾Œã®ç”»é¢ã‚’ç”¨æ„ã™ã‚‹æƒ³å®šã§ã™ã€‚
ï¼ˆä»Šå›ã¯èªè¨¼æ¸ˆã¿ã®å ´åˆã€Œã‚µã‚¤ãƒ³ã‚¤ãƒ³å¾Œã€ã¨ã„ã†æ–‡å­—ã«ãªã‚‹ã‚ˆã†ã«ã—ã¦ã‚ã‚Šã¾ã™ã€‚ï¼‰

![](https://storage.googleapis.com/zenn-user-upload/51b333dfab41-20230225.png =600x)
*ã‚µã‚¤ãƒ³ã‚¤ãƒ³å¾Œã®çŠ¶æ…‹*

## ã“ã®è¨˜äº‹ã®å¯¾è±¡èª­è€…

- `React`ã‹`Next.js`ã‚’åˆ©ç”¨ã™ã‚‹æ–¹
- `cognito`ã®èªè¨¼ã‚’åˆ©ç”¨ã™ã‚‹æ–¹
- `Amplify`ã‚’åˆ©ç”¨ã›ãšã«ã€`CloudFront`ã‚„ãã®ä»–ã®æ–¹æ³•ã§ç‹¬è‡ªã«ã‚µã‚¤ãƒˆã‚’ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã™ã‚‹æ–¹


## ãƒ‡ãƒ—ãƒ­ã‚¤ç’°å¢ƒ

åˆ©ç”¨ã—ãŸãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®ä¸»ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒª

- react: 18.2.0
- Next.js: 13.2.1
- MUI: 5.10.12
- react-hook-form: 7.43.2
- aws-amplify: 5.0.15

# ã‚³ãƒ¼ãƒ‰

ä»Šå›ã®ã‚³ãƒ¼ãƒ‰ã¯[ã“ã®ãƒªãƒã‚¸ãƒˆãƒª](https://github.com/gsy0911/zenn-cognito-frontend-auth)ã«è¼‰ã›ã¦ã‚ã‚Šã¾ã™ã®ã§é©å®œå‚è€ƒã«ã—ã¦ãã ã•ã„ã€‚

ä»¥ä¸‹ã‹ã‚‰ç°¡å˜ã«å†…å®¹ã‚’ç´¹ä»‹ã—ã¦ã„ãã¾ã™ã€‚

## ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ

```text
frontend/
â”œâ”€â”€ components
â”‚  â”œâ”€â”€ model
â”‚  â”‚  â””â”€â”€ Header
â”‚  â”‚     â”œâ”€â”€ Header.tsx ğŸ‘ˆ è¦‹ãŸç›®ã‚’å°‘ã—ã‚ˆãã™ã‚‹ãŸã‚ã«ç”¨æ„ã—ãŸãƒ˜ãƒƒãƒ€ãƒ¼
â”‚  â”‚     â””â”€â”€ index.ts
â”‚  â””â”€â”€ page
â”‚     â”œâ”€â”€ Auth
â”‚     â”‚  â”œâ”€â”€ AuthBasePage.tsx ğŸ‘ˆ a
â”‚     â”‚  â”œâ”€â”€ PasswordChange.form.tsx ğŸ‘ˆ a
â”‚     â”‚  â”œâ”€â”€ PasswordForget.form.tsx ğŸ‘ˆ a
â”‚     â”‚  â”œâ”€â”€ PasswordReset.form.tsx ğŸ‘ˆ a
â”‚     â”‚  â”œâ”€â”€ SignIn.form.tsx ğŸ‘ˆ a
â”‚     â”‚  â””â”€â”€ SignInComplete.form.tsx ğŸ‘ˆ a
â”‚     â””â”€â”€ index.ts
â”œâ”€â”€ lib
â”‚  â””â”€â”€ cognito-auth.tsx ğŸ‘ˆ a
â”œâ”€â”€ next.config.js
â”œâ”€â”€ package-lock.json
â”œâ”€â”€ package.json
â”œâ”€â”€ pages
â”‚  â”œâ”€â”€ _app.tsx
â”‚  â”œâ”€â”€ _document.tsx
â”‚  â”œâ”€â”€ index.tsx
â”‚  â”œâ”€â”€ password-change
â”‚  â”‚  â””â”€â”€ index.tsx ğŸ‘ˆ ã€Œãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´ã€ã‚’è¡¨ç¤º
â”‚  â”œâ”€â”€ password-forget
â”‚  â”‚  â””â”€â”€ index.tsx ğŸ‘ˆ ã€Œãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¿˜ã‚Œç”»é¢ã€ã¨ã€Œãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å†è¨­å®šã€ã‚’è¡¨ç¤º
â”‚  â””â”€â”€ signin
â”‚     â””â”€â”€ index.tsx ğŸ‘ˆ ã€Œã‚µã‚¤ãƒ³ã‚¤ãƒ³ç”»é¢ã€ã¨ã€Œåˆå›ã‚µã‚¤ãƒ³ã‚¤ãƒ³å®Œäº†ç”»é¢ã€ã‚’è¡¨ç¤º
â””â”€â”€ tsconfig.json
```

[//]: # (ä»Šå›ã¯ ğŸ‘ˆ ã§ãƒãƒ¼ã‚¯ã®ã‚ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å¤‰æ›´ãƒ»è¿½åŠ ã—ã¾ã™ã€‚)

## cognitoã®è¨­å®š

## èªè¨¼ç”¨ãƒ•ãƒƒã‚¯ã®æº–å‚™

ä»Šå›ã®å¤§äº‹ãªã‚³ãƒ¼ãƒ‰ã®1ã¤ã§ã‚ã‚‹`cognito-auth.tsx`ã‚’è¨˜è¿°ã—ã¾ã™ã€‚
èªè¨¼ã®å„ç¨®é–¢æ•°ã‚„çŠ¶æ…‹ã‚’ç®¡ç†ã™ã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚
ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯ã€[å‚è€ƒè¨˜äº‹](https://mseeeen.msen.jp/react-auth-with-ready-made-cognito/)å†…å®¹ã«ã„ãã¤ã‹ã®é–¢æ•°ã‚’è¿½åŠ ã—ã¦ã„ã¾ã™ã€‚

ãƒ•ã‚¡ã‚¤ãƒ«ã¯é•·ã„ã®ã§ã€è¦‹ãŸã„å ´åˆã¯ã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³ã‚’é–‹ã„ã¦ãã ã•ã„ã€‚

::::details èªè¨¼ç”¨ãƒ•ãƒƒã‚¯ã®è©³ç´°

```typescript jsx: cognito-auth.tsx
import {Auth, Amplify} from 'aws-amplify';
import React, {createContext, useContext, useEffect, useState} from 'react';

const AwsConfigAuth = {
  region: process.env.NEXT_PUBLIC_COGNITO_REGION,
  userPoolId: process.env.NEXT_PUBLIC_COGNITO_USER_POOL_ID,
  userPoolWebClientId: process.env.NEXT_PUBLIC_COGNITO_WEB_CLIENT_ID,
  authenticationFlowType: 'USER_SRP_AUTH',
}

Amplify.configure({Auth: AwsConfigAuth});

interface UseAuth {
  isLoading: boolean;
  isAuthenticated: boolean;
  username: string;
  currentAuthenticatedUser: () => Promise<any>;
  signUp: (username: string, password: string) => Promise<Result>;
  confirmSignUp: (verificationCode: string) => Promise<Result>;
  signIn: (username: string, password: string) => Promise<Result>;
  signInComplete: (username: string, oldPassword: string, newPassword: string) => Promise<Result>;
  signOut: () => void;
  changePassword: (user: any, oldPassword: string, newPassword: string, newPasswordConfirm: string) => Promise<Result>;
  forgetPassword: (email: string) => Promise<Result>;
  resetPassword: (username: string, code: string, newPassword: string, newPasswordConfirm: string) => Promise<Result>;
}

interface Result {
  success: boolean
  message: string
  hasChallenge?: boolean
  challengeName?: string
}

const authContext = createContext({} as UseAuth);

export const ProvideAuth: React.FC<{ children: React.ReactNode }> = ({children}) => {
  const auth = useProvideAuth();
  return <authContext.Provider value={auth}> {children} </authContext.Provider>;
};

export const useAuth = () => {
  return useContext(authContext);
};

const useProvideAuth = (): UseAuth => {
  const [isLoading, setIsLoading] = useState(true);
  const [isAuthenticated, setIsAuthenticated] = useState(false);
  const [username, setUsername] = useState('');
  const [password, setPassword] = useState('');

  useEffect(() => {
    Auth.currentAuthenticatedUser()
      .then((result) => {
        setUsername(result.username);
        setIsAuthenticated(true);
        setIsLoading(false);
      })
      .catch(() => {
        setUsername('');
        setIsAuthenticated(false);
        setIsLoading(false);
      });
  }, []);

  const signUp = async (username: string, password: string) => {
    try {
      await Auth.signUp({username, password});
      setUsername(username);
      setPassword(password);
      return {success: true, message: ''};
    } catch (error) {
      return {
        success: false,
        message: 'èªè¨¼ã«å¤±æ•—ã—ã¾ã—ãŸã€‚',
      };
    }
  };

  const confirmSignUp = async (verificationCode: string) => {
    try {
      await Auth.confirmSignUp(username, verificationCode);
      const result = await signIn(username, password);
      setPassword('');
      return result;
    } catch (error) {
      return {
        success: false,
        message: 'èªè¨¼ã«å¤±æ•—ã—ã¾ã—ãŸã€‚',
      };
    }
  };

  const signIn = async (username: string, password: string): Promise<Result> => {
    try {
      const result = await Auth.signIn(username, password);
      const hasChallenge = Object.prototype.hasOwnProperty.call(result, 'challengeName')
      setUsername(result.username);
      setIsAuthenticated(true);
      if (hasChallenge) {
        const challengeName = result.challengeName
        return {success: true, message: '', hasChallenge: true, challengeName};
      }
      return {success: true, message: '', hasChallenge: false}
    } catch (error) {
      return {
        success: false,
        message: 'èªè¨¼ã«å¤±æ•—ã—ã¾ã—ãŸã€‚',
      };
    }
  };

  const signInComplete = async (username: string, oldPassword: string, newPassword: string) => {
    try {
      const user = await Auth.signIn(username, oldPassword)
      await Auth.completeNewPassword(user, newPassword, user.challengeParam.requiredAttributes)
      return {
        success: true,
        message: ""
      }
    } catch (error) {
      if (error instanceof Error) {
        if (error.name === "InvalidParameterException" || error.name === "InvalidPasswordException") {
          return {
            success: false,
            message: 'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯è‹±å­—/æ•°å­—çµ„ã¿åˆã‚ã›ã®8æ¡ä»¥ä¸Šã§å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚',
          };

        } else if (error.name === "NotAuthorizedException") {
          return {
            success: false,
            message: 'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé–“é•ã£ã¦ã„ã¾ã™ã€‚',
          };

        } else if (error.name === "ExpiredCodeException") {
          return {
            success: false,
            message: 'ä»®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®æœ‰åŠ¹æœŸé™ãŒåˆ‡ã‚Œã¦ã„ã¾ã™ã€‚ã‚«ã‚¹ã‚¿ãƒãƒ¼ã‚µãƒãƒ¼ãƒˆã¸ã”é€£çµ¡ãã ã•ã„ã€‚',
          };

        } else if (error.name === "AuthError") {
          return {
            success: false,
            message: 'ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚',
          };

        } else if (error.name === "UserNotFoundException") {
          return {
            success: false,
            message: 'ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¾ãŸã¯ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“ã€‚',
          };

        }
      }
      return {
        success: false,
        message: 'äºˆæœŸã›ã¬ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚',
      };
    }
  }

  const signOut = async () => {
    try {
      await Auth.signOut();
      setUsername('');
      setIsAuthenticated(false);
      return {success: true, message: ''};
    } catch (error) {
      return {
        success: false,
        message: 'ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã«å¤±æ•—ã—ã¾ã—ãŸã€‚',
      };
    }
  };

  const changePassword = async (user: any, oldPassword: string, newPassword: string, newPasswordConfirm: string) => {
    try {
      if (newPassword === newPasswordConfirm) {
        await Auth.changePassword(user, oldPassword, newPassword);
        return {
          success: true,
          message: '',
        };
      } else {
        return {
          success: false,
          message: 'å…¥åŠ›ã—ãŸæ–°è¦ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒä¸€è‡´ã—ã¾ã›ã‚“ã€‚ã‚‚ã†ä¸€åº¦å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚',
        };
      }
    } catch (error) {
      if (error instanceof Error) {
        if (error.name === "NotAuthorizedException") {
          return {
            success: false,
            message: 'ç¾åœ¨ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé–“é•ã£ã¦ã„ã¾ã™ã€‚',
          };
        } else if (error.name === "LimitExceededException") {
          return {
            success: false,
            message: 'ã—ã°ã‚‰ãæ™‚é–“ã‚’ç½®ã„ã¦å†åº¦è©¦ã—ã¦ãã ã•ã„ã€‚',
          };
        } else if (error.name === "InvalidPasswordException") {
          return {
            success: false,
            message: 'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯è‹±å­—ï¼ˆå°æ–‡å­—å¿…é ˆï¼‰/æ•°å­—çµ„ã¿åˆã‚ã›ã®8æ¡ä»¥ä¸Šã§å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚',
          };
        } else if (error.name === "InvalidParameterException") {
          return {
            success: false,
            message: 'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚',
          };
        }
      }
      return {
        success: false,
        message: 'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚',
      };
    }
  }

  const forgetPassword = async (email: string) => {
    const regex = /^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
    if (regex.test(email)) {

      try {
        await Auth.forgotPassword(email)
        return {
          success: true,
          message: '',
        }

      } catch (error) {
        return {
          success: false,
          message: 'äºˆæœŸã›ã¬ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ',
        }

      }
    } else {
      return {
        success: false,
        message: 'ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã®å½¢å¼ã§å…¥åŠ›ã—ã¦ãã ã•ã„',
      };
    }
  }

  const resetPassword = async (username: string, code: string, newPassword: string, newPasswordConfirm: string) => {
    if (newPassword !== newPasswordConfirm) {
      return {
        success: false,
        message: 'å…¥åŠ›ã—ãŸæ–°è¦ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒä¸€è‡´ã—ã¾ã›ã‚“ã€‚ã‚‚ã†ä¸€åº¦å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚'
      }
    }
    try {
      await Auth.forgotPasswordSubmit(username, code, newPassword);
      return {
        success: true,
        message: ""
      }

    } catch (error) {
      if (error instanceof Error) {
        if (error.name === "InvalidParameterException" || error.name === "InvalidPasswordException") {
          return {
            success: false,
            message: 'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯è‹±å­—ï¼ˆå°æ–‡å­—å¿…é ˆï¼‰/æ•°å­—çµ„ã¿åˆã‚ã›ã®8æ¡ä»¥ä¸Šã§å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚',
          };
        } else if (error.name === "AuthError" || error.name === "ExpiredCodeException" || error.name === "LimitExceededException") {
          if (error.message === "Confirmation code cannot be empty") {
            return {
              success: false,
              message: 'ã‚³ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚',
            };
          } else {
            return {
              success: false,
              message: 'ã‚³ãƒ¼ãƒ‰ã®æœ‰åŠ¹æœŸé™ãŒåˆ‡ã‚Œã¦ã„ã¾ã™ã€‚å†åº¦ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»é¢ã‹ã‚‰ã€Œç·¨é›†ã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„ã€‚',
            };
          }
        } else if (error.name === "CodeMismatchException") {
          return {
            success: false,
            message: 'ã‚³ãƒ¼ãƒ‰ãŒé–“é•ã£ã¦ã„ã¾ã™ã€‚',
          };
        }
      }
      return {
        success: false,
        message: "äºˆæœŸã›ã¬ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ"
      }
    }
  }

  return {
    isLoading,
    isAuthenticated,
    username,
    currentAuthenticatedUser: () => Auth.currentAuthenticatedUser(),
    signUp,
    confirmSignUp,
    signIn,
    signInComplete,
    signOut,
    changePassword,
    forgetPassword,
    resetPassword
  };
};

```
::::

å¤‰æ›´ç‚¹ã¯ã€ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚

- `signInComplete`, `changePassword`, `forgetPassword`, `resetPassword`ã®é–¢æ•°ã®è¿½åŠ ã€‚
  - ã“ã‚Œã«ã‚ˆã£ã¦ã€å¿…è¦ãªå‡¦ç†ã‚’å®Ÿè£…ã§ãã¾ã™ã€‚
- `currentAuthenticatedUser`ã®è¿½åŠ ã€‚
  - userã‚’å–å¾—ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

## å„ç¨®èªè¨¼ç”»é¢ã®ä½œæˆ

å„ç¨®ç”»é¢ã¯ã€`AuthBasePage.tsx`ã¨å„ç¨®`*.form.tsx`ã‚’ãã‚Œãã‚Œçµ„ã¿åˆã‚ã›ã¦ä½œæˆã—ã¾ã™ã€‚

`AuthBasePage.tsx`ã ã‘ã§ã¯ã€ä»¥ä¸‹ã®å†…å®¹ã‚’è¡¨ç¤ºã™ã‚‹ã‚ˆã†ã«ãªã£ã¦ãŠã‚Šã€
å„ç¨®`*.form.tsx`ãŒãã‚Œãã‚Œã®å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ ã«ãªã£ã¦ã„ã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/a63c2667ad40-20230225.png =600x)
*`AuthBasePage.tsx`ã®ã¿ã§è¡¨ç¤ºã•ã‚Œã‚‹å†…å®¹*

::::details ã‚³ãƒ¼ãƒ‰è©³ç´°

ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã¯ã€ã»ã¨ã‚“ã©ã“ã®[å‚è€ƒè¨˜äº‹](https://qiita.com/shunnami/items/98a341d2ac20775241ad)ã®å†…å®¹ãŒãƒ™ãƒ¼ã‚¹ã«ãªã£ã¦ã„ã¾ã™ã€‚

```typescript jsx: AuthBasePage.tsx
import React, {createContext, useContext, useState} from 'react';
import {Alert, Avatar, Grid, Paper, Snackbar, Typography} from "@mui/material";
import {teal} from "@mui/material/colors";
import LockOutlinedIcon from "@mui/icons-material/LockOutlined";

interface UseAuthPage {
  setIsError: (state: boolean) => void
  setErrorMessage: (state: string) => void
}

const authPageContext = createContext({} as UseAuthPage);

export const useAuthPage = () => {
  return useContext(authPageContext);
};

export const AuthBasePage: React.FC<{ title: string, children: React.ReactNode }> = ({title, children}) => {
  const [isError, setIsError] = useState(false);
  const [errorMessage, setErrorMessage] = useState('');

  const value = {
    setIsError,
    setErrorMessage
  }

  return (
    <>
      <Grid>
        <Paper
          elevation={3}
          sx={{
            p: 4,
            height: "70vh",
            width: "280px",
            m: "20px auto"
          }}
        >
          <Grid
            container
            direction="column"
            justifyContent="flex-start" //å¤šåˆ†ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆflex-startãªã®ã§çœç•¥ã§ãã‚‹ã€‚
            alignItems="center"
          >
            <Avatar sx={{bgcolor: teal[400]}}>
              <LockOutlinedIcon/>
            </Avatar>
            <Typography variant={"h6"} sx={{m: "30px"}}>
              {title}
            </Typography>
          </Grid>
          <authPageContext.Provider value={value}>
            {children}
          </authPageContext.Provider>

        </Paper>
      </Grid>
      {/*ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸*/}
      <Snackbar open={isError} autoHideDuration={null}>
        <Alert onClose={() => setIsError(false)} severity="error" sx={{width: '100%'}}>
          {errorMessage}
        </Alert>
      </Snackbar>
    </>
  )
}

```

::::

![](https://storage.googleapis.com/zenn-user-upload/99f9a9e63896-20230225.png =600x)
*ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¿˜ã‚Œç”»é¢*

![](https://storage.googleapis.com/zenn-user-upload/ffb6b2886b5d-20230225.png =600x)
*ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å†è¨­å®šç”»é¢*

![](https://storage.googleapis.com/zenn-user-upload/6d972248aa69-20230225.png =600x)
*ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´ç”»é¢*


# ãŠã‚ã‚Šã«

# å‚è€ƒ

- ä¸€ç•ªå‚è€ƒã«ã—ãŸè¨˜äº‹ï¼š[Amplify ã‚’ä½¿ã‚ãš React ã§ AWS Cognito èªè¨¼ã‚’ä½¿ã†](https://mseeeen.msen.jp/react-auth-with-ready-made-cognito/)
- [ã€MUIã€‘ã‚³ãƒ”ãƒšã§ä½¿ãˆã‚‹ï¼šãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸](https://qiita.com/shunnami/items/98a341d2ac20775241ad)
- [React åˆå¿ƒè€…ãŒ Material-UI ã§ä»Šã©ãã® Web ãƒ•ã‚©ãƒ¼ãƒ ã‚’ä½œã£ã¦ã¿ãŸï¼ˆreact-hook-formç·¨ï¼‰](https://dev.classmethod.jp/articles/react-beginners-tried-to-create-a-modern-web-form-with-material-ui-and-react-hook-form/)
- [react-hook-formã®ä½¿ã„æ–¹ã¾ã¨ã‚](https://qiita.com/NozomuTsuruta/items/60d15d97eeef71993f06#seterror)