---
title: "感謝の高速移動ijkl"
emoji: "✨"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["neovim"]
published: false
---


# はじめに


備忘録がてらまとめます。WezTermを触り始めて、LazyGitなどを入れてみると、ターミナルで全て完結できるのもいいなと思い始めました。

この記事は、neovimを触りつつ、またプラグインも入れながら書いています。

# 前提

実行する環境・プラグインなどは以下の通りです。

* macOS Sequoia 15.0
* nvim: v0.10.1
  * プラグインマネージャー: lazy.nvim

# インストール

brewにて`neovim`をインストールしています。

```
$ brew install neovim
```

その後に、`$ nvim`でneovimを開くことができます。

# 表記について

vim/neovimでは`<C-@>`や`<S-@>`などの表記を見かけます。これらはvimのキーマッピングで`<C-@>`の時は`Ctrl`キーと何かを、`<S-@>`の時は`Shift`キーと何かのキーを押下することを意味しています。詳しくは以下の記事をご覧ください。

https://kannokanno.hatenablog.com/entry/2013/05/05/130219

また、そのほかにも`<Leader>`という表記も見かけます。これはユーザーが自由に割り当てることのできる複数入力のキーです。そのため、既存の`<C-@>`などと被りにくく自由度が高いです。

https://vim.blue/leader-key/

# 基本操作

Vimには以下のモードが存在します。

* Normal mode
* Insert mode
* Command mode
* Visual mode


## Normal mode

画面を開いた直後の状態です。キーを押下することで画面移動やコピーなどができます。

### Normal mode: 移動


| キー | 操作 |
|:--:|:--|
| h | 左移動 |
| j | 下移動 |
| k | 上移動 |
| l | 右移動 |
| $ | 末尾に移動 |
| 0 | 先頭に移動 |
| { | 段落ごとに上に移動 |
| } | 段落ごとに下に移動 |
| [[ | セクションごとに上に移動 |
| ]] | セクションごとに下に移動 |
| <C-b> | ページを上に送る |
| <C-f> | ページを下に移動 |
| gg | ファイルの先頭に移動 |
| G | ファイルの末尾に移動 |

:::message
最初は辛かったですが、慣れるとホームポジションから矢印に移動するのも面倒になってきました。`0`と`$`はあまり使わないで、代わりに`I`と`A`をよく使います。移動した直後から入力開始できるからです。
:::

### Normal mode: 移動して入力モードへ移行

| キー | 操作 |
|:--:|:--|
| a | カーソルの右側から入力を開始 |
| A | 行の末尾から入力を開始 |
| i | カーソルの左側から入力を開始 |
| I | 行の先頭から入力を開始 |
| e | 英単語のスペース区切り前などに移動 |
| o | 改行して入力を開始 |
| O | 下に改行をして上に入力を開始 |
| C | カーソルのある位置から末尾までを削除してInsert modeに |
| c0 | カーソルのある一から先頭まで削除をしてInsert modeに |
| cc | カーソルのある行を削除してInsert modeに |

:::message
慣れてくると、`A`と`I`は意外と便利で、`O`とかも地味に使うようになってきます。
:::

### Normal mode: コピー

ここでは、Normal modeのみで完結するコピーのコマンドのみですが、実際は後述するVisual modeでコピー範囲を選択してなどの方法をよく使います。

| キー | 操作 |
|:--:|:--|
| yy | 無名レジスタに行コピー|
| dd | 行を切り取り |
| p | 無名レジスタの内容を貼り付け |
| x | カーソル上の文字を削除（Deleteキーと同じ） |

### Normal mode: 検索

| キー | 操作 |
|:--:|:--|
| /検索したい文字列 | 文字の検索 |
| n | 次の検索結果に移動 |
| N | 前の検索結果に移動 |
|  |  |


### Normal mode: その他

| キー | 操作 |
|:--:|:--|
| u | 直前の入力を削除（Ctrl + Zと同じ挙動） |
|  |  |
|  |  |



helloworld!!yoshikihello
fheiafea





## Insert mode

文字を入力するモードです。普段のテキストエディタと同じ感覚で使うことができます。`<esc>`キーを入力することでNormal modeに戻ることができます。ただ、`<esc>`を入力するのはちょっと手の移動が大きいので別のキーにマッピングするのが便利でいいです。次の記事でもあるように`<C-g>`や`jj`に割り当てると操作しやすくなります。

https://qiita.com/RepublicOfKorokke/items/0a267b53156cd8a64a59

上記の設定をする場合、以下のように記述すると良いです。

```lua: init.lua
vim.keymap.set("i", "jj", "<esc>")
```

:::message
ただし、日本語入力のままの状態で`jj`を押下すると、`っj`となり、Normal modeに移行できないのがたまに煩雑だなと思います。
:::

## Command mode

様々なコマンドを実行するモードです。Normal modeから`:`を入力して切り替えることができます。`<esc>`で再びNormal modeに戻ることができます。

よく利用するコマンドは以下の通りです。

| キー | 操作 |
|:--:|:--:|
| :u | 直前の操作を取り消す |
| :q | 終了する |
| :q! | 保存しないで終了する |
| :w | 保存する |

:::message
意外と`:u`のコマンドは便利です。何か変な操作をしてしまっても冷静に`<esc>`を押して、`:u`を押せばとりあえず元に戻ります。
:::
## Visual mode

テキストの領域選択を出来るモードです。Normal modeから`v` or `V` or `<C-v>`のいずれかの入力で切り替えることができます。

| キー | 操作 |
|:--:|:--:|
| v | vを押したところから選択ができる |
| V | Vを押した行全体を選択できる |
| `<C-V>` | 矩形選択が出来る |

上記のコマンドで範囲選択をした後に`d`や`y`で切り取りやコピーができます。

# プラグイン

vimを使う際にはプラグインを入れるのが必須になるかと思います。複数のプラグインを導入するために、プラグインマネージャーをまずは導入します。色々ありますが、`lazyvim`を導入しています。

https://github.com/folke/lazy.nvim

公式の設定にあるように以下の設定を追記していきます。


```lua: ~/.config/nvim/init.lua
-- Bootstrap lazy.nvim
local lazypath = vim.fn.stdpath("data") .. "/lazy/lazy.nvim"
if not (vim.uv or vim.loop).fs_stat(lazypath) then
  local lazyrepo = "https://github.com/folke/lazy.nvim.git"
  local out = vim.fn.system({ "git", "clone", "--filter=blob:none", "--branch=stable", lazyrepo, lazypath })
  if vim.v.shell_error ~= 0 then
    vim.api.nvim_echo({
      { "Failed to clone lazy.nvim:\n", "ErrorMsg" },
      { out, "WarningMsg" },
      { "\nPress any key to exit..." },
    }, true, {})
    vim.fn.getchar()
    os.exit(1)
  end
end
vim.opt.rtp:prepend(lazypath)

-- Make sure to setup `mapleader` and `maplocalleader` before
-- loading lazy.nvim so that mappings are correct.
-- This is also a good place to setup other settings (vim.opt)
vim.g.mapleader = " "
vim.g.maplocalleader = "\\"

-- Setup lazy.nvim
require("lazy").setup({
  spec = {
    -- add your plugins here
  },
  -- Configure any other settings here. See the documentation for more details.
  -- colorscheme that will be used when installing plugins.
  install = { colorscheme = { "habamax" } },
  -- automatically check for plugin updates
  checker = { enabled = true },
})
```

この状態で、`spec`にプラグインを追記していくことで複数のプラグインを管理・インストールできます。ただ、この状態を続けていると`init.lua`が非常に大きくなり管理しづらくなります。`lazy.nvim`ではプラグインを管理するファイルを分割することができます。それは上記のファイルの`spec`を編集します。


```diff lua: ~/.config/nvim/init.lua
  spec = {
+    { { import = "pluging" } }
  },
```

このようにすることで、`~/.config/nvim/lua/plugins/*.lua`で作成したプラグインを読み込むことが可能です。
この状態で、`$ nvim {filename}`で適当なファイルを開くと、lazy.nvimによってプラグインのインストールが始まります。

![](/images/nvim_initial/nvim_initial_01.png)
*nvim起動時のlazy.nvimの画面*

上記の画面は`:Lazy`コマンドで呼び出すことも可能です。そのほかの操作については以下の記事を参照してください。

https://zenn.dev/siteyo/articles/980b6205e93914

## plugins: ファイラー

ファイラーには`nvim-tree`を使います。以下のファイルを`~/.config/nvim/lua/plugins/nvim-tree.lua`作成します。

```
-- open File Tree when open
local function open_nvim_tree()
    require("nvim-tree.api").tree.open()
end

vim.api.nvim_create_autocmd({ "VimEnter" }, { callback = open_nvim_tree })

return {
  "nvim-tree/nvim-tree.lua",
  version = "*",
  lazy = false,
  dependencies = {
    "nvim-tree/nvim-web-devicons",
  },
  keys = {
    {mode = "n", "<C-n>", "<cmd>NvimTreeToggle<CR>", desc = "NvimTreeをトグルする"},
    {mode = "n", "<C-m>", "<cmd>NvimTreeFocus<CR>", desc = "NvimTreeにフォーカス"},
  },
  config = function()
    require("nvim-tree").setup {
      git = {
        enable = true,
        ignore = true,
      }
    }
  end,
}

```


## plugins: ファジーファインダー

https://zenn.dev/yutakatay/articles/vim-fuzzy-finder


## plugins: Git


ファイルに変更・追記がある行を表示するようにします。少し長いですが、デフォルトの設定とともに以下のようにファイルを作成します。

https://github.com/lewis6991/gitsigns.nvim

```lua: ~/.config/nvim/lua/config/gitsigns.lua
return {
  "lewis6991/gitsigns.nvim",
  config = function()
    require('gitsigns').setup {
      signs = {
        add          = { text = '┃' },
        change       = { text = '┃' },
        delete       = { text = '_' },
        topdelete    = { text = '‾' },
        changedelete = { text = '~' },
        untracked    = { text = '┆' },
      },
      signs_staged = {
        add          = { text = '┃' },
        change       = { text = '┃' },
        delete       = { text = '_' },
        topdelete    = { text = '‾' },
        changedelete = { text = '~' },
        untracked    = { text = '┆' },
      },
      signs_staged_enable = true,
      signcolumn = true,  -- Toggle with `:Gitsigns toggle_signs`
      numhl      = false, -- Toggle with `:Gitsigns toggle_numhl`
      linehl     = false, -- Toggle with `:Gitsigns toggle_linehl`
      word_diff  = false, -- Toggle with `:Gitsigns toggle_word_diff`
      watch_gitdir = {
        follow_files = true
      },
      auto_attach = true,
      attach_to_untracked = false,
      current_line_blame = false, -- Toggle with `:Gitsigns toggle_current_line_blame`
      current_line_blame_opts = {
        virt_text = true,
        virt_text_pos = 'eol', -- 'eol' | 'overlay' | 'right_align'
        delay = 1000,
        ignore_whitespace = false,
        virt_text_priority = 100,
        use_focus = true,
      },
      current_line_blame_formatter = '<author>, <author_time:%R> - <summary>',
      sign_priority = 6,
      update_debounce = 100,
      status_formatter = nil, -- Use default
      max_file_length = 40000, -- Disable if file is longer than this (in lines)
      preview_config = {
        -- Options passed to nvim_open_win
        border = 'single',
        style = 'minimal',
        relative = 'cursor',
        row = 0,
        col = 1
      },
    }
  end
}
```

## plugins: comment

コメントアウトの機能には`Comment.nvim`を使います。以下のファイルを新規作成します。そうするとNormal modeで`gcc`で、Visual modeで`gc`を押下することで、コメントのトグルをすることができます。

```lua: ~/.config/nvim/lua/config/comment.lua
return {
    'numToStr/Comment.nvim',
    opts = {
        -- add any options here
    }
}
```

# そのほか


Chromeの操作もvimと合わせてみます

https://zenn.dev/gkz/articles/vimium-beginners-guide

# おわりに

## 参考

https://qiita.com/naomaruru/items/95e2ed811b8b8c8bb053
https://qiita.com/RepublicOfKorokke/items/0a267b53156cd8a64a59
https://zenn.dev/peloeil/articles/a9c579ba24b225
https://qiita.com/0829/items/c4ba0e7aa274c2d0b34f
https://qiita.com/mutsuki15/items/4abce9d107304d3dd120
https://zenn.dev/yutakatay/articles/vim-fuzzy-finder
https://qiita.com/hachi8833/items/7beeee825c11f7437f54
https://zenn.dev/vim_jp/articles/43d021f461f3a4
https://qiita.com/ysmb-wtsg/items/79be0d97711eb49f5e82#4-completion

