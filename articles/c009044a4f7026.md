---
title: "neovimを使って4ヶ月"
emoji: "🏃"
type: "idea" # tech: 技術記事 / idea: アイデア
topics: ["neovim", "aerospace"]
published: false
---

2024年の9月末からNeovimを触り始めて、4ヶ月が経過しました。
Neovimを使い始めてから4ヶ月経って感じたこと・メリットとデメリットなどを軽くまとめます。

# neovimを使っての所感

## ウィンドウの切り替えがすぐできて楽で良い

まず、Neovimでのコーディングに慣れたかと言うと2024年の12月中旬くらいには慣れていました。少なくとも、コーディングはほぼNeovim上で完結できるようになりました。ブラウザなどどうしても必要な場合以外はターミナルにこもることができるので非常に体験として良いです。特に、「コード編集〜コミット」までの流れの体験が良いです。
キーボードだけで完結するため、コーディングへのモチベーションが上がります。

| 操作・時間軸 | 以前 | 現在 |
|:---:|:---:|:---:|
| コード編集 | PyCharmで編集 | neovim (on WezTerm)で編集 |
| ↓ | トラックパッド操作 | キーボード操作 |
| ↓ | 4本指でスワイプしてmission-controlから | `space -> l -> g`を順に押下 |
| ↓ | Forkを見つけ選択する(3秒くらい) | (ほぼ0秒) |
| Git操作 | ファイルを選んでダブルクリックなどでstaging | ファイルを選んで`space`+`jk`でstaging |

文字に起こすとそうでもない気がしますが、ターミナルの中に居続けることができ対象のウィンドウを見つける煩雑さから解放されたのは大きいです。行ごとのコミットも`lazygit`で問題なくできるので、そういった点でも通常のcommitに関しては不自由なく実行できます。

そのほかの気に入っている点として、異なるリポジトリ間のエディタの移動がとても楽になりました。以前はだいたい3リポジトリくらいはPyCharmなどで開いており、集約された状態を切り替えて使っていました。その場合もマウス操作で切り替えていました（もしかしたらショートカットがあったのかもしれません）。それが今では、ターミナル上の異なるウィンドウ（WezTermにおけるペイン）でneovimを開いておき、`⌘ + Shift + j (or k)`で移動できます。また、ターミナルでのコマンド実行も同様に`⌘ + Shift + j (or k)`で切り替えて実行できるので、とても良いです。

キーボード操作のみで完結するエディタなので、快適にコーディングができます。矢印キーでの移動すら面倒に感じるようになりました。

## `dotfiles`の編集でneovimに慣れる

使い始めの時は、zennの記事を書くときに使ったり、dotfilesの更新するときに使ったりしていました。9月末くらいからしばらくはdotfilesの更新くらいしか利用できていませんでしたが、12月くらいからは、使い方も慣れてきてコードの編集もできるようになってきました。ただ、最後まで慣れなかったのは、カラースキーマです。ずっとIntellijの配色に慣れていたこともあり、そこが変わってしまうと、コードが全く読めませんでした。今は、だいぶん慣れたこともあり、少しずつですが書けるようになりました。

Intellij系のエディタの文字色に慣れていたため、neovimの配色に慣れるまでに時間がかかりました。配色を頑張れば近づけることもできるのですが、一旦一番目に馴染む以下の`onenord`と言うcolorschemaを利用しています。

https://github.com/rmehri01/onenord.nvim

## 無理にneovim上で完結しようとしない

コンフリクト解消などのneovimであまり行わない操作については、今でもPyCharmなどの使い慣れたIDEを使用してしまいます。一応`diff-view`と言うプラグインを入れているので、neovim上で解決もできるのですが頻度が多くなく慣れたPyCharmを使ってしまいます。

今はほとんどないですが、neovimでのコーディングに慣れる11月末くらいまでは、PyCharmなどと併用してコーディングしていました。無理にneovimを使いすぎないことも大事だと思っています。あと、ちょっとしたファイルの中身を見たい時には逆にVSCodeをまだ使ったりしています。

## LLMの活用はこれから

LLMを活用したコード補完については、まだ十分に対応できていません。一応`avante`や`parrot`、`codecompanion`などのプラグインを利用すればLLMを利用したコード支援は活用できますが、まだ改善の余地があるかなと思います。


# neovim以外への影響

neovim以外の操作に関しても、キーボードでの操作で完結できるようになりました。neovimを使っていると、ターミナルの中によりこもりたくなってきます。それに伴ってエディタ以外にも快適に操作できるようにしてきました。

## 影響①: zshのアップデートとキーバインドの追加

今まで、プライングマネージャとして`zinit`を利用していました。ただ、最近は`sheldon`と言うのがRustで書かれており起動も早いと言うことで乗り換えました。元々のzshの起動時間が遅かったということもあって、切り替えた直後はあまり早いと思いませんでしたが設定などを見直して、今は`50[ms]`くらいで起動するようになったので、いい感じです。

```sh
$ time zsh -i -c exit
zsh -i -c exit  0.05s user 0.05s system 71% cpu 0.148 total
```

また、指を矢印キーに持っていくのが面倒なので`Ctrl + K`が↑キーと、`Ctrl + J`が↓キーと同じ動作をするように設定を加えました。

```txt: zshrc
bindkey '^k' history-beginning-search-backward
bindkey '^j' history-beginning-search-forward
```

こうすることで、矢印キーに手を動かさなくても、直前に打ったコマンドなどを参照できるようになりました。

## 影響②: モニタ・ウィンドウの切り替え

https://zenn.dev/mozumasu/articles/mozumasu-window-costomization

上記の記事を見て、`aerospace`を導入しました。以前`yabai`などのウィンドウマネージャーの導入などを試みたのですが、設定のところがわかりにくく諦めていました。一方、aerospaceはパッと見で設定の方法がわかりやすく、かつデフォルトで色々設定されており導入しやすかったです。

aerospaceを導入すると、`⌥ + 1`で`1`、`⌥ + 2`で`2`、`⌥ + c`で`c`、`⌥ + w`で`w`のワークスペースを切り替え・表示できます。私は、`⌥ + w`で`WezTerm`を、`⌥ + c`で`Chrome`を切り替えるように設定しています（その他にも`Slack`, `PyCharm`, `YouTube Music`, `Fork`, `VSCode`などを設定しています）。また、`⌥ + Tab`で直前にフォーカスしていたウィンドウに移動できるのも地味に便利で、ターミナルとブラウザを楽に行き来できます。

```toml: ~/.config/aerospace/aerospace.toml
[mode.main.binding]
alt-1 = 'workspace 1'
alt-2 = 'workspace 2'
（中略）
alt-c = 'workspace C'
（中略）
alt-w = 'workspace W'
```

:::message
私の使い方では、1ワークスペースにつき1ウィンドウで運用しています。
ウィンドウをワークスペース内で縦に分割して使うことはあまりしていないです。
:::

また、以下の設定で`Chrome`などを立ち上げると自動的にワークスペース`C`にChromeのウィンドウを移動するようにしてくれます。

```toml: ~/.config/aerospace/aerospace.toml
[[on-window-detected]]
if.app-id = 'com.google.Chrome'
run = 'move-node-to-workspace C'
```

ここまでのaerospaceのworkspaceとwindowのイメージを以下に表します。

```text: aerospaceのworkspaceとwindowのイメージ
1つのworkspaceに1つのwindowだと次のようになります
    +-------------------------+ +-- ...
    |(workspace 1)            | |(workspace ... 他のワークスペースも存在はしている)
    | +---------------------+ | |   ...
    | |(window) Chrome      | | |   ...
    | |                     | | |   ...
    | |                     | | |   ...
    | |                     | | |   ...
    | +---------------------+ | |   ...
    +-------------------------+ +-- ...

1つのworkspaceに2つのwindow（ChromeとTerminal）の状態です
（私はあまり使うことはないです）
    +-------------------------+
    | (workspace 1)           |
    | +---------+ +---------+ |
    | |(window) | |(window) | |
    | | Chrome  | |Terminal | |
    | |         | |         | |
    | |         | |         | |
    | +---------+ +---------+ |
    +-------------------------+

特定のworkspaceに特定のwindowだと次のようになります
（`⌥ + c`で`Chrome`が、`⌥ + w`で`WezTerm`が見えるようになっている）
    +-------------------------+ +-------------------------+
    |(workspace C)            | |(workspace W)            |
    | +---------------------+ | | +---------------------+ |
    | |(window) Chrome      | | | |(window) WezTerm     | |
    | |                     | | | |                     | |
    | |                     | | | |                     | |
    | |                     | | | |                     | |
    | +---------------------+ | | +---------------------+ |
    +-------------------------+ +-------------------------+
```

ここまではワークスペースとウィンドウだけの話ですが、ワークスペースを特定のモニタに自動的に割り当てることもできます。

```text: aerospaceのmonitorとworkspaceとwindowのイメージ
モニタが3台ある場合のイメージ
  +=====================+　+=====================+　+=====================+
  |(monitor 1)          |　|(monitor 2)          |　|(monitor 3)          |
  | +-----------------+ |　| +-----------------+ |　| +-----------------+ |
  | |(workspace C)    | |　| |(workspace W)    | |　| |(workspace M)    | |
  | +-----------------+ |　| +-----------------+ |　| +-----------------+ |
  +=====================+　+=====================+　+=====================+
```
`workspace-to-monitor-force-assignment`を利用すると、特定のモニタにウィンドウの割り当てができます。以下の設定で、向かって左のモニタにワークスペースの`CSTV`を、真ん中のモニタにワークスペースの`PW`を、右側のモニタに`DFM`を自動的に設置するようにします。

```toml: ~/.config/aerospace/aerospace.toml
[workspace-to-monitor-force-assignment]
C = 1
D = 3
F = 3
M = 3
P = 2
S = 1
T = 1
V = 1
W = 2
```

```text: aerospaceの上記の設定のイメージ
`⌥ + c`で`Chrome`にフォーカスが、`⌥ + w`で`WezTerm`にフォーカスが当たる。

`⌥ + c`で(monitor 1)にあるChromeにフォーカスをした後に、
`⌥ + s`を押下すると、Slackが(monitor 1)にてフォーカスされる
  +=====================+　+=====================+　+=====================+
  |(monitor 1)          |　|(monitor 2)          |　|(monitor 3)          |
  | +-----------------+ |　| +-----------------+ |　| +-----------------+ |
  | |(workspace C)    | |　| |(workspace P)    | |　| |(workspace D)    | |
  | +-----------------+ |　| +-----------------+ |　| +-----------------+ |
  | +-----------------+ |　| +-----------------+ |　| +-----------------+ |
  | |(workspace S)    | |　| |(workspace W)    | |　| |(workspace F)    | |
  | +-----------------+ |　| +-----------------+ |　| +-----------------+ |
  | +-----------------+ |　|                     |　| +-----------------+ |
  | |(workspace T)    | |　|                     |　| |(workspace M)    | |
  | +-----------------+ |　|                     |　| +-----------------+ |
  | +-----------------+ |　|                     |　|                     |
  | |(workspace V)    | |　|                     |　|                     |
  | +-----------------+ |　|                     |　|                     |
  +=====================+　+=====================+　+=====================+
```

:::message
`aerospace`では左側に設置されているモニタから自動的に1からインデックスが振られます。詳細は以下にありますが、メインディスプレイを意味する`main`やディスプレイの名前を文字列で指定できます。
https://nikitabobko.github.io/AeroSpace/guide#assign-workspaces-to-monitors
:::


私の環境は、macに[SANWA 400-VGA023](https://direct.sanwa.co.jp/ItemPage/400-VGA023)を接続して、DisplayLinkを介して合計3枚のディスプレイを繋げて作業をしています。aerospaceを使うことでシングルモニタでも作業の負担、主にウィンドウの切り替えが軽減されました。


## 影響③: Chromeをvimっぽく操作する

以下の拡張機能を入れると、`jk`で画面のスクロールをし、`f`でリンクの選択などができるようになります。どうしても動かないページなどは出てきてしまいますが、スクロールができるようになるのはとても便利なので使っています。


https://chromewebstore.google.com/detail/vimium/dbepggeogbaibhgnhhndojpepiihcmeb?hl=ja


# おわりに

使い始めて4ヶ月くらいが経過してどんな感じなのか軽くまとめてみました。
neovimとかターミナルに篭り続けるのは、体験として非常に良いのでこれからも続けていきます。

