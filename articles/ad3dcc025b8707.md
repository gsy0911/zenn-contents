---
title: "Playwrightを使ってMantineの自動テスト"
emoji: "👌"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["playwright", "mantine", "nextjs", "e2e"]
published: false
---

# はじめに

Mantine便利ですよね。

MantineのE2Eテストを実行するときに、自動テストで記録される項目と各種可能な操作を記録していきます。
画面を見ながら作成できるのが一番ですが、コードを見ながらでもテストを作成できることを想定しています。

https://mantine.dev/getting-started/

上記のページの左タブの`MANTINE CORE`に表示されている内容の取得方法を備忘録的にまとめます。
例外的に`Layout`と`Compobox`は除いています。

# 背景

`data-testid`を付与するのがいいと思っていましたが、playwrightだとあまり推奨していないみたいです。
そのため、実際に自動テストで記録される項目を記録していきます。
文字サイズ・ボールド・divやpaddingなども合わせて確認できたらいいな。

# 実行環境

- macOS: 14.1
- Next.js: 14.0
- Node.js: 20.1
- Mantine: 7.2.2
- Playwright: 7.2.2

## 準備

以下のコマンドで`Playwright`をインストールします。

```shell
$ npm init playwright@latest

Initializing project in '.'
✔ Where to put your end-to-end tests? · tests
✔ Add a GitHub Actions workflow? (y/N) · true
✔ Install Playwright browsers (can be done manually via 'npx playwright install')? (Y/n) · true
Installing Playwright Test (npm install --save-dev @playwright/test)…
```


# テスト項目

それぞれのコンポーネントごとにテストコードを列挙していきます。

::: message
ハイドレーションなどをきちんと考慮したコードにはなっていないです。
:::

各種コンポーネントにおいて、`aria-label`を指定すると`page.getByLabel(aria-label)`で要素を取れるようになります。
ただ要素を指定できないコンポーネントなどもあるため適宜列挙していきます。

# `aria-label`について

WAI-ARIAで策定されているアクセシビリティに関する要素です。ウェブの読み上げなどにも用いられており、正しく設定することが求められています。
テスト用に設定しつつアクセシビリティにも配慮できるようになるのはいいなと思いました。

## `Inputs`

### Checkbox

```typescript: test/mantine-input.tsx
<Checkbox defaultChecked label="I agree to sell my privacy" aria-label={"Checkbox"} />
```

```typescript
// 要素を押下したとき
await page.getByLabel('Checkbox').check();
await page.getByLabel('Checkbox').uncheck();
```

### Chip


```typescript: test/mantine-input.tsx
<Chip defaultChecked aria-label={"Chip"}>
  Awesome chip
</Chip>
```

```typescript
await page.getByText('Awesome chip').click();
```

::: message
`Chip`は`aria-label`を指定しても、`getByLabel`で要素取得はできませんでした。
:::

### Input(JsonInput)

```typescript: test/mantine-input.tsx
<JsonInput
  label="Your package.json"
  placeholder="Textarea will autosize to fit the content"
  validationError="Invalid JSON"
  formatOnBlur
  autosize
  minRows={4}
  aria-label={"JsonInput"}
/>
```

```typescript
// 選択した場合
await page.getByPlaceholder('Textarea will autosize to fit').click();
// 文字を入力した場合
await page.getByPlaceholder('Textarea will autosize to fit').fill('hello');
```

::: message
`JsonInput`は`aria-label`を指定しても、`getByLabel`で要素取得はできませんでした。
:::

### Input(NativeSelect)

```typescript: test/mantine-input.tsx
<NativeSelect
  label="Input label"
  description="Input description"
  data={["React", "Angular", "Vue"]}
  aria-label={"NativeInput"}
/>
```

```typescript
// 各要素を選択した場合
await page.getByLabel('NativeInput').selectOption('React');
await page.getByLabel('NativeInput').selectOption('Angular');
await page.getByLabel('NativeInput').selectOption('Vue');
```


### Input(NumberInput)

```typescript: test/mantine-input.tsx
<NumberInput
  label="NumberInput label"
  description="Input description"
  placeholder="Input placeholder"
  aria-label={"NumberInput"}
/>
```

```typescript
// 要素を押下したとき
await page.getByLabel('NumberInput').click();
await page.getByRole('textbox', { name: 'NumberInput label', exact: true }).click();
// 要素に値を入力したとき
await page.getByLabel('NumberInput').fill('111');
await page.getByRole('textbox', { name: 'NumberInput label', exact: true }).fill('111');
// 要素の右端の上ボタンを押下したとき
await page.locator('button').first().click();
// 要素の右端の下ボタンを押下したとき
await page.locator('button').nth(1).click();
```

### Input(PasswordInput)

```typescript: test/mantine-input.tsx
<PasswordInput
  label="PasswordInput label"
  description="Input description"
  placeholder="Input placeholder"
  aria-label={"PasswordInput"}
/>
```

```typescript
// 要素を押下したとき
await page.getByLabel('PasswordInput').click();
// 要素に値を入力したとき
await page.getByLabel('PasswordInput').fill('hello');
// 要素の右端のパスワード表示・非表示ボタンを押下したとき
await page.locator('div').filter({ hasText: /^PasswordInput labelInput description$/ }).locator('button').click();
```
### PinInput

```typescript: test/mantine-input.tsx
<PinInput aria-label={"PinInput"} />
```

```typescript
// 要素を押下したとき
await page.locator('#mantine-83000ppxm-1').click();
// 要素に値を順次入力して行ったとき
await page.locator('#mantine-83000ppxm-1').fill('1');
await page.locator('#mantine-83000ppxm-2').fill('2');
await page.locator('#mantine-83000ppxm-3').fill('3');
await page.locator('#mantine-83000ppxm-4').fill('4');
```

::: message
`PinInput`は`aria-label`を指定しても、`getByLabel`で要素取得はできませんでした。
:::

### Radio

```typescript: test/mantine-input.tsx
<Radio label="I cannot be unchecked" aria-label={"Radio"} />
```

```typescript
// 要素を押下したとき
await page.getByLabel('Radio').dblclick();
await page.getByText('I cannot be unchecked').click();
```

### Rating

```typescript: test/mantine-input.tsx
<Rating defaultValue={2} aria-label={"Rating"} />
```

```typescript
// 4番目の要素を押下したとき
await page.locator('div:nth-child(4) > .m-21342ee4 > .m-fae05d6a > .m-5662a89a').click();
```

::: message
`Rating`は`aria-label`を指定しても、`getByLabel`で要素取得はできませんでした。
:::

### SegmentedControl

```typescript: test/mantine-input.tsx
<SegmentedControl data={["React", "Angular", "Vue"]} aria-label={"SegmentedControl"} />
```

```typescript
// 各要素を押下したとき
await page.getByLabel('SegmentedControl').getByText('React').click();
await page.getByLabel('SegmentedControl').getByText('Angular').click();
await page.getByLabel('SegmentedControl').getByText('Vue').click();
```

### Slider

```typescript: test/mantine-input.tsx
<Slider
  color="blue"
  marks={[
    { value: 20, label: "20%" },
    { value: 50, label: "50%" },
    { value: 80, label: "80%" },
  ]}
  aria-label={"Slider"}
/>
```

::: message
`Slider`は自動選択ではうまく動きませんでした。
:::

### Switch

```typescript: test/mantine-input.tsx
<Switch defaultChecked label="I agree to sell my privacy" aria-label={"Switch"} />
```

::: message
`Switch`はUIでの選択ではうまく動きませんでした。
:::


```typescript
// （コードで直接入力）要素を押下する処理
await page.getByLabel('Switch').getByText('React').click();
```

### Textarea

```typescript: test/mantine-input.tsx
<Textarea
  label="Input label"
  description="Input description"
  placeholder="Input placeholder"
  aria-label={"Textarea"}
/>
```

```typescript
// 要素を押下したとき
await page.getByLabel('Textarea').click();
// 要素に入力したとき
await page.getByLabel('Textarea').fill('hello');
```

### TextInput

```typescript: test/mantine-input.tsx
<TextInput
  label="Input label"
  description="Input description"
  placeholder="Input placeholder"
  aria-label={"TextInput"}
/>
```

```typescript
// 要素を押下したとき
await page.getByLabel('TextInput').click();
// 要素に入力したとき
await page.getByLabel('TextInput').fill('hello');
```

## `Buttons`


例外的に`CopyButton`と`FileButton`は、中の`Button`要素に`aria-label`が必要です。

### ActionIcon

```typescript: test/mantine-input.tsx
<ActionIcon variant="filled" aria-label="ActionIcon">
  <IconAdjustments style={{ width: "70%", height: "70%" }} stroke={1.5} />
</ActionIcon>
```

```typescript
// 要素を押下したとき
await page.getByLabel('ActionIcon').click();
```

### Button

```typescript: test/mantine-input.tsx
<Button variant="filled" aria-label={"Button"}>Button</Button>
```

```typescript
// 要素を押下したとき
await page.getByLabel('Button', { exact: true }).click();
```

### CloseButton

```typescript: test/mantine-input.tsx
<CloseButton />
```

```typescript
// 要素を押下したとき
await page.getByLabel('CloseButton').click();
```

### CopyButton

```typescript: test/mantine-input.tsx
<CopyButton value="https://mantine.dev">
  {({ copied, copy }) => (
    <Button aria-label={"CopyButton"} color={copied ? "teal" : "blue"} onClick={copy}>
      {copied ? "Copied url" : "Copy url"}
    </Button>
  )}
</CopyButton>
```

```typescript
// 要素を押下したとき
await page.getByLabel('CopyButton').click();
```

### FileButton

```typescript: test/mantine-input.tsx
<>
  <Group justify="center">
    <FileButton onChange={setFile} accept="image/png,image/jpeg">
      {(props) => <Button {...props} aria-label={"FileButton"}>Upload image</Button>}
    </FileButton>
  </Group>

  {file && (
    <Text size="sm" ta="center" mt="sm">
      Picked file: {file.name}
    </Text>
  )}
</>
```

```typescript
// 要素を押下したとき
await page.getByLabel('FileButton').click();
```

以降の処理は？

### UnstyledButton

```typescript: test/mantine-input.tsx
<UnstyledButton aria-label={"UnstyledButton"}>Button without styles</UnstyledButton>
```

```typescript
// 要素を押下したとき
await page.getByLabel('UnstyledButton').click();
```

## `Navigation`

### a

```typescript: test/mantine-input.tsx
<Anchor href="https://mantine.dev/" target="_blank">
  Anchor component
</Anchor>
```

```typescript
//
```

### a

```typescript: test/mantine-input.tsx
<>
  <Breadcrumbs>{items}</Breadcrumbs>
  <Breadcrumbs separator="→" separatorMargin="md" mt="xs">
    {items}
  </Breadcrumbs>
</>
```

```typescript
//
```

### a

```typescript: test/mantine-input.tsx
<Burger opened={opened} onClick={toggle} aria-label="Toggle navigation" />
```

```typescript
//
```

### a

```typescript: test/mantine-input.tsx
<NavLink href="#required-for-focus" label="With icon" leftSection={<IconHome2 size="1rem" stroke={1.5} />} />
```

```typescript
//
```

### a

```typescript: test/mantine-input.tsx
<Pagination total={10} />
```

```typescript
//
```

### a

```typescript: test/mantine-input.tsx
<>
	<Stepper active={active} onStepClick={setActive}>
		<Stepper.Step label="First step" description="Create an account">
			Step 1 content: Create an account
		</Stepper.Step>
		<Stepper.Step label="Second step" description="Verify email">
			Step 2 content: Verify email
		</Stepper.Step>
		<Stepper.Step label="Final step" description="Get full access">
			Step 3 content: Get full access
		</Stepper.Step>
		<Stepper.Completed>Completed, click back button to get to previous step</Stepper.Completed>
	</Stepper>

	<Group justify="center" mt="xl">
		<Button variant="default" onClick={prevStep}>
			Back
		</Button>
		<Button onClick={nextStep}>Next step</Button>
	</Group>
</>
```

```typescript
//
```

### a

```typescript: test/mantine-input.tsx
<Tabs defaultValue="gallery">
	<Tabs.List>
		<Tabs.Tab value="gallery" leftSection={<IconPhoto style={iconStyle} />}>
			Gallery
		</Tabs.Tab>
		<Tabs.Tab value="messages" leftSection={<IconMessageCircle style={iconStyle} />}>
			Messages
		</Tabs.Tab>
		<Tabs.Tab value="settings" leftSection={<IconSettings style={iconStyle} />}>
			Settings
		</Tabs.Tab>
	</Tabs.List>

	<Tabs.Panel value="gallery">Gallery tab content</Tabs.Panel>

	<Tabs.Panel value="messages">Messages tab content</Tabs.Panel>

	<Tabs.Panel value="settings">Settings tab content</Tabs.Panel>
</Tabs>
```

```typescript
//
```

## `Feedback`

### a

```typescript: test/mantine-input.tsx
</>
```

```typescript
//
```


## `Overlays`
## `DataDisplay`
## `Typography`

# おわりに

# 参考文献

https://zenn.dev/tnyo43/articles/39e4caa321d0aa

https://zenn.dev/takky94/articles/4daa73dd516bf3
