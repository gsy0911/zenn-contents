---
title: "ReportLabã§Seabornã®ã‚°ãƒ©ãƒ•ã‚’SVGã§åŸ‹ã‚è¾¼ã‚€"
emoji: "ğŸ¨"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["python", "pdf", "reportlab"]
published: false
---

ReportLabã‚’ä½¿ã£ã¦PDFã‚’ä½œæˆæ™‚ã®ã€ç”»åƒã®åŸ‹ã‚è¾¼ã¿ã«é–¢ã™ã‚‹è¨˜äº‹ã§ã™ã€‚ç‰¹ã«svgãªã©ã®ãƒ™ã‚¯ã‚¿ç”»åƒã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä»‹ã•ãšã«ã€PDFã¸åŸ‹ã‚è¾¼ã‚€ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ç´¹ä»‹ã—ã¾ã™ã€‚

# ReportLabã ã‘ã§ã‚°ãƒ©ãƒ•å‡ºåŠ›ãƒ»åŸ‹ã‚è¾¼ã¿ã‚’å®Œçµã•ã›ã‚‹

ReportLabã§PDFã‚’å‡ºåŠ›ã™ã‚‹éš›ã«ã€Pythonã®pandasãªã©ã§é›†è¨ˆã—ã¦ã‚°ãƒ©ãƒ•ã‚’å‡ºåŠ›ã—ã¦ãã®ã¾ã¾PDFã«åŸ‹ã‚è¾¼ã¿ãŸã„ã§ã™ã‚ˆã­ï¼Ÿç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦å‡ºåŠ›ã—ã¦ã€ãã‚Œã‚’èª­ã¿è¾¼ã‚“ã§ã¿ãŸã„ãªæ‰‹é †ã‚’è¸ã‚€ã“ã¨ã‚‚ã§ãã¾ã™ãŒã€å¯èƒ½ãªã‚‰ã°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä»‹ã•ãªã„æ–¹ãŒæ¥½ã§ã™ã€‚

ä¸Šè¨˜ã®ã“ã¨ã¯ã€ReportLabã«å‚™ã‚ã£ã¦ã„ã‚‹æ©Ÿèƒ½ã§å®Ÿç¾ã§ãã¾ã™ã€‚

```python
# see: https://chocottopro.com/?p=227
# ã«ã‚ã‚‹ãƒ‡ãƒ¼ã‚¿/ã‚°ãƒ©ãƒ•ã‚’å‡ºåŠ›ã™ã‚‹ã‚³ãƒ¼ãƒ‰ã‚’å‚è€ƒã«ã—ã¦ã„ã¾ã™ã€‚

from reportlab.graphics.shapes import Drawing
from reportlab.graphics.charts.barcharts import VerticalBarChart
from reportlab.graphics import renderPDF
from reportlab.pdfgen import canvas
from reportlab.lib.pagesizes import A4, portrait


def main():
    file = "example.pdf"
    # A4ã®PDF
    page = canvas.Canvas(file, pagesize=portrait(A4))

    # ä»¥ä¸‹å¼•ç”¨å…ƒã‚³ãƒ¼ãƒ‰
    data = [
        (2010, 1000, 1500),
        (2011, 1500, 1800),
        (2012, 1800, 2000),
        (2013, 2000, 2500),
    ]
    drawing = Drawing(400, 200)
    chart = VerticalBarChart()
    chart.x = 50
    chart.y = 50
    chart.width = 300
    chart.height = 125
    chart.data = data
    chart.valueAxis.valueMin = 0
    chart.valueAxis.valueMax = 3000
    chart.valueAxis.valueStep = 500
    chart.categoryAxis.labels.boxAnchor = 'ne'
    chart.categoryAxis.labels.dx = 8
    chart.categoryAxis.labels.dy = -2
    chart.categoryAxis.labels.angle = 30
    drawing.add(chart)
    # ã“ã“ã ã‘å¤‰æ›´
    renderPDF.draw(drawing, canvas=page, x=50, y=50)
    # pdfã‚’å‡ºåŠ›
    page.save()


if __name__ == "__main__":
    main()
```


![](/images/reportlab_seaborn_etc/reportlab_seaborn_01.png =500x)
*ä¸Šã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã«ã‚ˆã£ã¦ä½œæˆã•ã‚Œã‚‹PDFãƒ•ã‚¡ã‚¤ãƒ«*


# ã‚°ãƒ©ãƒ•ã¯seabornãªã©ã§å‡ºåŠ›ã—ã¦PDFã«åŸ‹ã‚è¾¼ã‚€

ä¸Šè¨˜ã®ã‚ˆã†ã«ã€ReportLabã«ã‚ã‚‹æ©Ÿèƒ½ã ã‘ã§ã‚°ãƒ©ãƒ•ã‚’å‡ºåŠ›ãƒ»åŸ‹ã‚è¾¼ã¿ã¯ã§ãã¾ã™ã€‚ãŸã ã€ReportLabã§ã¯ãªãæœ‰åãªã‚°ãƒ©ãƒ•ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®å‡ºåŠ›ã‚’åˆ©ç”¨ã—ãŸã„å ´åˆãŒã‚ã‚‹ã¨æ€ã„ã¾ã™ã€‚åŠ ãˆã¦ã€jpgã‚„pngç”»åƒãªã©ã®ãƒ©ã‚¹ã‚¿ç”»åƒã§ã¯ãªãã€æ‹¡å¤§ã—ã¦ã‚‚ç¶ºéº—ãªã¾ã¾ã®svgã‚„epsã®ãƒ©ã‚¹ã‚¿ç”»åƒã®æ–¹ãŒå¥½ã¾ã—ã„ã§ã™ã€‚

ãã®æ™‚ã«ä¾¿åˆ©ãªã®ãŒ[svglib](https://pypi.org/project/svglib/)ã§ã™ã€‚ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚

```shell
$ pip install svglib
```

ä¸Šè¨˜ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¨ä»Šå›ã¯seabornã‚’ä½¿ã£ã¦ã‚°ãƒ©ãƒ•ã‚’å‡ºåŠ›ã—ã€ãã®ã¾ã¾PDFã«åŸ‹ã‚è¾¼ã¿ã¾ã™ã€‚ãƒã‚¤ãƒ³ãƒˆã¨ã—ã¦ã¯ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã«å‡ºåŠ›ã—ã¦ã„ãªã„ã¨ã“ã‚ã§ã™ã€‚

```python
# https://stats.biopapyrus.jp/python/pie-chart.html
# ã«ã‚ã‚‹ãƒ‡ãƒ¼ã‚¿/ã‚°ãƒ©ãƒ•ã‚’å‡ºåŠ›ã™ã‚‹ã‚³ãƒ¼ãƒ‰ã‚’å‚è€ƒã«ã—ã¦ã„ã¾ã™ã€‚

import matplotlib.pyplot as plt
import seaborn as sns
import numpy as np
from reportlab.pdfgen import canvas
from reportlab.lib.pagesizes import A4, portrait
from svglib.svglib import svg2rlg
from reportlab.graphics import renderPDF
from io import BytesIO


def main():
    file = "example2.pdf"
    # A4ã®PDF
    page = canvas.Canvas(file, pagesize=portrait(A4))

    # ä»¥ä¸‹å¼•ç”¨å…ƒã‚³ãƒ¼ãƒ‰
    plt.style.use('default')
    sns.set()
    sns.set_style('whitegrid')
    sns.set_palette('Set2')

    x = ['A', 'B', 'C', 'D', 'E']
    y = np.array([300, 220, 180, 90, 10])

    fig = plt.figure()
    ax = fig.add_subplot(1, 1, 1)
    ax.pie(y, labels=x, autopct="%1.1f%%")

    imgdata = BytesIO()
    plt.savefig(imgdata, format="svg")
    imgdata.seek(0)
    drawing = svg2rlg(imgdata)
    renderPDF.draw(drawing, canvas=page, x=50, y=50)
    # pdfã‚’å‡ºåŠ›
    page.save()


if __name__ == '__main__':
    main()
```

![](/images/reportlab_seaborn_etc/reportlab_seaborn_02.png =500x)
*ä¸Šã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã«ã‚ˆã£ã¦ä½œæˆã•ã‚Œã‚‹PDFãƒ•ã‚¡ã‚¤ãƒ«*

ç”»åƒã®åŸ‹ã‚è¾¼ã¿ã«é–¢ã—ã¦ã¯ã€`x`ã¨`y`ãŒã‚°ãƒ©ãƒ•ã®å·¦ä¸‹ã®ä½ç½®ã«ãªã‚Šã¾ã™ã€‚

```python
renderPDF.draw(drawing, canvas=page, x=50, y=50)
```

ã‚°ãƒ©ãƒ•ã®ã‚µã‚¤ã‚ºã‚’å¤‰ãˆãŸã„å ´åˆã¯ã€ä»¥ä¸‹ã®ç‚¹ã«ç•™æ„ã—ã¦ã„ã‚‹ã¨ã™ãã«å¤‰æ›å¯èƒ½ã§ã™ã€‚

seabornãªã©ã®pltã§æŒ‡å®šã™ã‚‹figsizeã®å˜ä½ã¯`ã‚¤ãƒ³ãƒ`ã§ã™ã€‚ãã®ãŸã‚ä»¥ä¸‹ã®ä¾‹ã§ã¯ç¸¦æ¨ª5ã‚¤ãƒ³ãƒã®ã‚°ãƒ©ãƒ•ã«ãªã‚Šã¾ã™ã€‚

```python
fig = plt.figure(figsize=(5, 5))
```

ä¸€æ–¹ã€PDFãªã©ã®å˜ä½ã¯ãƒ”ã‚¯ã‚»ãƒ«ã«ãªã‚Šã¾ã™ã€‚ã„ã‚ã„ã‚è©¦ã—ãŸã¨ã“ã‚ã€seabornã§ã®å‡ºåŠ›çµæœã®90å€ã®å€¤ãŒæ›ç®—ã—ãŸãƒ”ã‚¯ã‚»ãƒ«ã®å€¤ã«ãªã‚Šã¾ã™ã€‚ãã®ãŸã‚`figsize=(5,5)`ã§æŒ‡å®šã—ãŸå ´åˆã«ã¯`450x450`ã®å¤§ãã•ã«ãªã‚Šã¾ã™ã€‚

```python
page.rect(50, 50, 450, 450, fill=True)
renderPDF.draw(drawing, canvas=page, x=50, y=50)
```

![](/images/reportlab_seaborn_etc/reportlab_seaborn_03.png =500x)
*ä¸Šã®ã‚µã‚¤ã‚ºèª¿æ•´ã«ã‚ˆã£ã¦ä½œæˆã•ã‚Œã‚‹PDFãƒ•ã‚¡ã‚¤ãƒ«*

:::message
ReportLabã§å‡ºåŠ›ã•ã‚Œã‚‹PDFã®dpiã¯72ã‚‰ã—ã„ã®ã§ã€ã©ã†ã—ã¦90å€ã«ãªã‚‹ã®ã‹ãŒã„ã¾ã„ã¡ã‚ã‹ã£ã¦ã„ãªã„ã§ã™ã€‚ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã®ã‚ˆã†ã«å˜ä½ã‚’ã‚¤ãƒ³ãƒã§æƒãˆã¦ã‚‚åˆã†ã“ã¨ã¯ãªã72å€ã®æ–¹ãŒåˆè‡´ã—ã¦ã„ã¾ã™ã€‚

```python
from reportlab.lib.units import inch

page.rect(50, 50, 5*inch, 5*inch, fill=True)
renderPDF.draw(drawing, canvas=page, x=50, y=50)
# å¤§ãã•æ¯”è¼ƒã®ãŸã‚ã®å››è§’å½¢
page.rect(50, 500, 5*72, 5*72, fill=True)
page.rect(500, 50, 5*72, 5*72, fill=True)
```

![](/images/reportlab_seaborn_etc/reportlab_seaborn_04.png =500x)
*ä¸Šã®ã‚µã‚¤ã‚ºèª¿æ•´ã«ã‚ˆã£ã¦ä½œæˆã•ã‚Œã‚‹PDFãƒ•ã‚¡ã‚¤ãƒ«ï¼šä¸Šã¨å³å´ã®é»’ã®å››è§’å½¢ã¨å††ã‚°ãƒ©ãƒ•ã®å³ã¨ä¸‹ã«è¦‹åˆ‡ã‚Œã¦ã„ã‚‹ç·šã®é•·ã•ãŒåˆè‡´ã—ã¦ã„ã‚‹ï¼72å€ã®æ–¹ãŒåˆè‡´ã—ã¦ã„ã‚‹*

90å€ã«ã™ã‚Œã°ã„ã„ã¨ã„ã†ã®ã¯æ¥½ã§è¦šãˆã‚„ã™ã„ã®ã§ã™ãŒã€ã“ã†ãªã‚‹åŸå› ãŒã‚ã‹ã£ãŸã‚‰ã‚³ãƒ¡ãƒ³ãƒˆã§æ•™ãˆã¦æ¬²ã—ã„ã§ã™ã€‚

:::

ä»¥ä¸Šã€ReportLabã‚’ä½¿ã£ã¦ã‚°ãƒ©ãƒ•ã®åŸ‹ã‚è¾¼ã¿ã«ã¤ã„ã¦ç´¹ä»‹ã—ã¾ã—ãŸã€‚seabornãªã©ã®ã‚°ãƒ©ãƒ•ã‚’ãã®ã¾ã¾PDFåŒ–ã§ãã‚‹ã“ã¨ã¯ã„ã„ã¨æ€ã„ã¾ã™ã€‚ä¸€æ–¹ã§ã€ReportLabã¯å„APIãŒä½ãƒ¬ãƒ™ãƒ«ã™ãã¦æ‰±ã„ã«ããã€åˆ©ç”¨ã§ãã‚‹ã‚·ãƒ¼ãƒ³ã¯ã¨ã¦ã‚‚é™ã‚‰ã‚Œã¦ã„ã‚‹ãªã¨ã‚‚æ€ã„ã¾ã™ã€‚

ãã‚Œã§ã‚‚èª°ã‹ã®å‚è€ƒã«ãªã‚Œã°å¹¸ã„ã§ã™ã€‚


# ãã®ã»ã‹ã®å‚è€ƒ

https://zenn.dev/takahashi_m/articles/e00473bdeb9dd8
